# Codebase Report: Tmux Dock App Exploration
Generated: 2026-01-17

## Summary

**Tmux Dock** is a **React Native (Expo)** mobile application for managing tmux sessions across multiple remote hosts. The app provides a comprehensive terminal management interface with Docker container management capabilities. It uses Expo Router for file-based navigation and connects to a backend agent (Hono-based API) that runs on each host.

## App Type & Architecture

**Technology Stack:**
- **Framework:** React Native 0.81.5 with Expo ~54.0
- **Navigation:** Expo Router 6.0 (file-based routing)
- **State Management:** Custom context providers (StoreProvider, ProjectsProvider, QueryProvider)
- **Data Fetching:** TanStack Query v5.90
- **UI Components:** Custom glass-morphic design system
- **Backend:** Hono agent server (located in `/agent` directory)

**Key Libraries:**
- `@gorhom/bottom-sheet` - Bottom sheet modals
- `react-native-reanimated` - Animations
- `react-native-gesture-handler` - Gesture support
- `react-native-webview` - Terminal rendering with xterm.js
- `lucide-react-native` - Icons
- `@tanstack/react-query` - Data fetching/caching

## Project Structure

```
/
├── app/                    # Expo Router screens (file-based routing)
│   ├── index.tsx          # Home screen (main dashboard)
│   ├── _layout.tsx        # Root layout with providers
│   ├── hosts/             # Host management
│   │   ├── index.tsx      # Hosts list
│   │   ├── new.tsx        # Add new host
│   │   └── [id]/          # Dynamic host routes
│   │       ├── index.tsx  # Host detail screen
│   │       ├── edit.tsx   # Edit host
│   │       └── docker/    # Docker features
│   │           └── [containerId]/
│   │               ├── index.tsx    # Container detail
│   │               └── terminal.tsx # Container terminal
│   ├── projects/          # Project management
│   │   ├── index.tsx      # Projects list
│   │   ├── new.tsx        # Create project
│   │   └── [id]/
│   │       └── commands.tsx # Custom commands
│   ├── ports/             # Port monitoring
│   │   └── index.tsx      # Ports screen
│   ├── session/           # Tmux sessions
│   │   └── [hostId]/[name]/
│   │       ├── index.tsx    # Session detail
│   │       └── terminal.tsx # Terminal view
│   └── keybinds.tsx       # Tmux keybinds
├── components/            # Reusable UI components
├── lib/                   # Core logic & utilities
│   ├── types.ts          # TypeScript type definitions
│   ├── api.ts            # API client
│   ├── store.tsx         # Host storage
│   ├── projects-store.tsx # Project storage
│   ├── live.ts           # Live data hooks
│   └── theme.ts          # Design system
├── agent/                 # Backend server (Hono)
└── constants/             # App constants
```

## Navigation Structure

### Entry Point: Home Screen (`app/index.tsx`)

The home screen serves as the main dashboard with **5 primary navigation paths**:

```
Home Screen (index.tsx)
├── [1] Hosts → /hosts
├── [2] Projects → /projects  
├── [3] Ports → /ports
├── [4] Sessions (inline list, tap to view)
└── [5] Launch Sheet (bottom sheet for quick actions)
```

### Navigation Flow to Docker Features

**Path 1: Via Home → Host Card (2 taps)**
```
1. Home Screen
   ↓ (tap host card)
2. Host Detail (/hosts/[id])
   ↓ (tap "Docker" button in header OR "View all" in Docker section)
3. Docker Screen (/hosts/[id]/docker)
```

**Path 2: Docker Container Detail (3 taps from home)**
```
1. Home Screen
   ↓ (tap host card)
2. Host Detail (/hosts/[id])
   ↓ (tap container in preview list - shows first 6)
3. Container Detail (/hosts/[id]/docker/[containerId])
   ↓ (tap "Terminal" button)
4. Container Terminal (/hosts/[id]/docker/[containerId]/terminal)
```

**Path 3: Via Hosts List (3 taps)**
```
1. Home Screen
   ↓ (tap "Hosts" nav card)
2. Hosts List (/hosts)
   ↓ (tap host)
3. Host Detail (/hosts/[id])
   ↓ (tap "Docker" button)
4. Docker Screen (/hosts/[id]/docker)
```

### Docker Feature Click Distance

| Feature | Minimum Taps | Path |
|---------|-------------|------|
| **Docker Overview** | 2 | Home → Host Detail → Docker button |
| **Container List** | 2 | Home → Host Detail → Docker section |
| **Container Detail** | 3 | Home → Host → Container |
| **Container Terminal** | 4 | Home → Host → Container → Terminal |
| **Container Actions** | 3 | Home → Host → Container (actions on detail) |

## Main Screens/Pages

### Core Screens

| Screen | Route | Purpose |
|--------|-------|---------|
| **Home** | `/` | Dashboard with sessions, hosts overview |
| **Hosts List** | `/hosts` | Manage all host connections |
| **Host Detail** | `/hosts/[id]` | Host info, sessions, Docker preview |
| **Projects List** | `/projects` | Saved projects with quick launch |
| **Ports** | `/ports` | Monitor open ports across hosts |
| **Keybinds** | `/keybinds` | Send tmux keyboard shortcuts |

### Docker Screens

| Screen | Route | Purpose |
|--------|-------|---------|
| **Docker Dashboard** | `/hosts/[id]/docker` | Containers, images, volumes, networks |
| **Container Detail** | `/hosts/[id]/docker/[containerId]` | Container info, stats, actions |
| **Container Terminal** | `/hosts/[id]/docker/[containerId]/terminal` | Interactive terminal (xterm.js) |

### Session Screens

| Screen | Route | Purpose |
|--------|-------|---------|
| **Session Detail** | `/session/[hostId]/[name]` | Session info, attach commands |
| **Session Terminal** | `/session/[hostId]/[name]/terminal` | Full tmux terminal view |

## Docker-Related Files

### Frontend (App)

```
app/hosts/[id]/docker.tsx                           # Docker dashboard
app/hosts/[id]/docker/[containerId]/index.tsx       # Container detail
app/hosts/[id]/docker/[containerId]/terminal.tsx    # Container terminal
app/hosts/[id]/index.tsx                            # Host detail (Docker preview)
```

### Backend (Agent)

The agent server (Hono-based) provides:
- `/docker/containers` - List containers with stats
- `/docker/images` - List images
- `/docker/volumes` - List volumes
- `/docker/networks` - List networks
- `/docker/exec` - WebSocket endpoint for container shell
- `/docker/action` - Start/stop/restart containers

### Types

```typescript
// lib/types.ts

export type DockerSnapshot = {
  available: boolean;
  error?: string;
  containers: DockerContainer[];
  images: DockerImage[];
  volumes: DockerVolume[];
  networks: DockerNetwork[];
};

export type DockerContainer = {
  id: string;
  name: string;
  image: string;
  status?: string;
  state?: string;
  ports?: string;
  cpuPercent?: number;
  memoryPercent?: number;
  memoryUsage?: string;
  // ... more fields
};
```

## Key Features & Patterns

### 1. Live Data Updates

Uses `useHostLive()` hook to poll host status, sessions, and Docker info:

```typescript
// Example from docker.tsx
const { state, refresh } = useHostLive(host, { docker: true });
const docker = state?.docker;
```

### 2. WebView-Based Terminals

Both tmux sessions and Docker containers use WebView + xterm.js:
- Loads xterm.js from CDN
- Connects via WebSocket to agent
- Full terminal emulation with copy/paste support

### 3. Glass-Morphic Design

Custom design system with:
- `GlassCard` component
- Color-coded hosts (via `hostAccents`)
- Consistent spacing/typography (via `theme`)

### 4. Multi-Host Management

Store structure:
```typescript
type Store = {
  hosts: Host[];        // SSH/Mosh connection configs
  ready: boolean;       // AsyncStorage loaded
}
```

### 5. Project Quick Launch

Projects link to:
- Host
- Working directory path
- Custom commands (package.json scripts or manual)

Launches tmux session with command in correct directory.

## Navigation Components

### Primary Navigation Cards (Home Screen)

```typescript
// From app/index.tsx
<GlassCard onPress={() => router.push('/hosts')}>
  <ServerIcon />
  <AppText>Hosts</AppText>
</GlassCard>

<GlassCard onPress={() => router.push('/projects')}>
  <FolderIcon />
  <AppText>Projects</AppText>
</GlassCard>

<GlassCard onPress={() => router.push('/ports')}>
  <PortsIcon />
  <AppText>Ports</AppText>
</GlassCard>
```

### Host Detail Navigation

```typescript
// From app/hosts/[id]/index.tsx (header buttons)
<Pressable onPress={() => router.push(`/hosts/${host.id}/docker`)}>
  <AppText>Docker</AppText>
</Pressable>

// Docker section with preview
<SectionHeader 
  title="Docker"
  action={
    <Pressable onPress={() => router.push(`/hosts/${host.id}/docker`)}>
      <AppText>View all</AppText>
    </Pressable>
  }
/>
```

### Docker Navigation

```typescript
// Container list item
<Pressable 
  onPress={() => router.push(`/hosts/${host.id}/docker/${container.id}`)}
>
  {/* Container card */}
</Pressable>

// Terminal button (in container detail)
<Pressable 
  onPress={() => router.push(`/hosts/${host.id}/docker/${container.id}/terminal`)}
>
  <AppText>Terminal</AppText>
</Pressable>
```

## Docker Feature Accessibility Summary

**Current UX:**
- Docker is **secondary navigation** - accessed from Host Detail screen
- Requires **2 taps minimum** from home to see Docker dashboard
- **3 taps** to interact with specific container
- **4 taps** to open container terminal

**Visibility:**
- Docker preview shown on Host Detail screen (first 6 containers)
- Quick "Docker" button in Host Detail header
- "View all" link below Docker section

**Integration:**
- Docker data fetched alongside sessions/host info via `useHostLive()`
- Real-time stats (CPU%, memory usage) displayed
- Container actions (start/stop/restart) available on detail screen

## Key Files by Concern

### Docker Implementation

| File | Purpose | Entry Points |
|------|---------|--------------|
| `app/hosts/[id]/docker.tsx` | Docker dashboard | `HostDockerScreen()` |
| `app/hosts/[id]/docker/[containerId]/index.tsx` | Container detail | `DockerContainerScreen()` |
| `app/hosts/[id]/docker/[containerId]/terminal.tsx` | Container terminal | `DockerTerminalScreen()` |
| `lib/api.ts` | API client | `dockerContainerAction()` |
| `lib/types.ts` | Type definitions | Docker* types |

### Core Navigation

| File | Purpose | Entry Points |
|------|---------|--------------|
| `app/index.tsx` | Home dashboard | `HomeScreen()` |
| `app/_layout.tsx` | Root layout | `RootLayout()` |
| `app/hosts/index.tsx` | Hosts list | `HostsScreen()` |
| `app/hosts/[id]/index.tsx` | Host detail | `HostDetailScreen()` |

### State Management

| File | Purpose | Entry Points |
|------|---------|--------------|
| `lib/store.tsx` | Host storage | `useStore()`, `StoreProvider` |
| `lib/live.ts` | Live data polling | `useHostLive()`, `useHostsLive()` |
| `lib/projects-store.tsx` | Project storage | `useProjects()`, `ProjectsProvider` |

## Conventions Discovered

### Naming

- **Files:** kebab-case (`docker.tsx`, `host-detail.tsx`)
- **Components:** PascalCase (`HostDockerScreen`, `GlassCard`)
- **Hooks:** camelCase with `use` prefix (`useHostLive`, `useStore`)
- **Types:** PascalCase (`DockerContainer`, `HostStatus`)

### File Organization

- **Route files:** Mirror URL structure via Expo Router
- **Dynamic routes:** Use `[param]` folders/files
- **Components:** Single component per file, named export as default
- **Types:** Centralized in `lib/types.ts`

### Patterns

| Pattern | Usage | Example |
|---------|-------|---------|
| **Custom hooks** | Data fetching | `useHostLive()`, `useProjects()` |
| **Context providers** | Global state | `StoreProvider`, `QueryProvider` |
| **Glass cards** | Primary UI containers | `<GlassCard>` |
| **Screen wrapper** | Consistent layout | `<Screen>` component |
| **File-based routing** | Navigation | Expo Router convention |

### Testing

- No test files found in current structure
- Test framework: `react-test-renderer` installed but no tests written

### Styling

- **Approach:** StyleSheet.create() for each screen
- **Theme:** Centralized in `lib/theme.ts`
- **Colors:** Palette-based (`palette.bg`, `palette.text`)
- **Spacing:** Theme-based (`theme.spacing.sm`, `theme.spacing.md`)

## Architecture Map

```
[Mobile App (React Native + Expo)]
         |
         | HTTP/WebSocket
         ↓
  [Agent Server (Hono) on each host]
         |
         ├─→ [Tmux Commands] → Local tmux sessions
         ├─→ [Docker API] → Docker daemon
         ├─→ [System Info] → Host metrics
         └─→ [Port Scanner] → netstat/lsof
```

### Data Flow

```
User Interaction
    ↓
Router Navigation (expo-router)
    ↓
Screen Component
    ↓
Custom Hook (useHostLive)
    ↓
TanStack Query (polling)
    ↓
API Client (lib/api.ts)
    ↓
Agent Server (HTTP)
    ↓
System Commands (tmux/docker/etc)
```

## Open Questions

1. **Agent deployment:** How is the agent installed/updated on hosts?
2. **Authentication:** Token-based auth - is there a setup wizard?
3. **Multi-platform:** Android/iOS support status?
4. **Offline mode:** Does app cache data when hosts are unreachable?
5. **Docker compose:** Support for docker-compose projects?
6. **Container logs:** Streaming logs available?

## Recommendations for Improving Docker Accessibility

If the goal is to make Docker features more prominent:

1. **Add Docker quick-access card on home screen** (1 tap vs 2)
2. **Show Docker status badge on host cards** (e.g., "3 running")
3. **Add "All Containers" view** aggregating across all hosts
4. **Add Docker tab bar** on Host Detail screen (Sessions | Docker | Info)
5. **Swipe gesture** from Host Detail to Docker screen

Current 2-tap access is reasonable for a feature that's secondary to tmux session management (the app's primary purpose).
